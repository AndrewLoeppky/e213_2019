{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0,
    "toc": true
   },
   "source": [
    "<h1>Table of Contents<span class=\"tocSkip\"></span></h1>\n",
    "<div class=\"toc\"><ul class=\"toc-item\"><li><span><a href=\"#Putting-it-all-together\" data-toc-modified-id=\"Putting-it-all-together-1\"><span class=\"toc-item-num\">1&nbsp;&nbsp;</span>Putting it all together</a></span><ul class=\"toc-item\"><li><span><a href=\"#1-D-steady---state-diffusion-stencil-(aligned-in-the-x-direction)\" data-toc-modified-id=\"1-D-steady---state-diffusion-stencil-(aligned-in-the-x-direction)-1.1\"><span class=\"toc-item-num\">1.1&nbsp;&nbsp;</span>1-D steady - state diffusion stencil (aligned in the x direction)</a></span></li></ul></li><li><span><a href=\"#5---gridblock-example\" data-toc-modified-id=\"5---gridblock-example-2\"><span class=\"toc-item-num\">2&nbsp;&nbsp;</span>5 - gridblock example</a></span><ul class=\"toc-item\"><li><ul class=\"toc-item\"><li><span><a href=\"#Gridblock-1\" data-toc-modified-id=\"Gridblock-1-2.0.1\"><span class=\"toc-item-num\">2.0.1&nbsp;&nbsp;</span>Gridblock 1</a></span></li><li><span><a href=\"#Gridblock-2\" data-toc-modified-id=\"Gridblock-2-2.0.2\"><span class=\"toc-item-num\">2.0.2&nbsp;&nbsp;</span>Gridblock 2</a></span></li><li><span><a href=\"#Gridblock-3\" data-toc-modified-id=\"Gridblock-3-2.0.3\"><span class=\"toc-item-num\">2.0.3&nbsp;&nbsp;</span>Gridblock 3</a></span></li><li><span><a href=\"#Gridblock-4\" data-toc-modified-id=\"Gridblock-4-2.0.4\"><span class=\"toc-item-num\">2.0.4&nbsp;&nbsp;</span>Gridblock 4</a></span></li><li><span><a href=\"#Gridblock-5\" data-toc-modified-id=\"Gridblock-5-2.0.5\"><span class=\"toc-item-num\">2.0.5&nbsp;&nbsp;</span>Gridblock 5</a></span></li><li><span><a href=\"#Collecting-all-equations\" data-toc-modified-id=\"Collecting-all-equations-2.0.6\"><span class=\"toc-item-num\">2.0.6&nbsp;&nbsp;</span>Collecting all equations</a></span></li></ul></li><li><span><a href=\"#Simplify\" data-toc-modified-id=\"Simplify-2.1\"><span class=\"toc-item-num\">2.1&nbsp;&nbsp;</span>Simplify</a></span></li><li><span><a href=\"#Equations-for-unknown-concentrations\" data-toc-modified-id=\"Equations-for-unknown-concentrations-2.2\"><span class=\"toc-item-num\">2.2&nbsp;&nbsp;</span>Equations for unknown concentrations</a></span></li></ul></li><li><span><a href=\"#Solve-the-system-of-equations\" data-toc-modified-id=\"Solve-the-system-of-equations-3\"><span class=\"toc-item-num\">3&nbsp;&nbsp;</span>Solve the system of equations</a></span><ul class=\"toc-item\"><li><ul class=\"toc-item\"><li><span><a href=\"#Your-answer-here:\" data-toc-modified-id=\"Your-answer-here:-3.0.1\"><span class=\"toc-item-num\">3.0.1&nbsp;&nbsp;</span>Your answer here:</a></span></li><li><span><a href=\"#Your-turn\" data-toc-modified-id=\"Your-turn-3.0.2\"><span class=\"toc-item-num\">3.0.2&nbsp;&nbsp;</span>Your turn</a></span></li><li><span><a href=\"#Your-turn\" data-toc-modified-id=\"Your-turn-3.0.3\"><span class=\"toc-item-num\">3.0.3&nbsp;&nbsp;</span>Your turn</a></span></li></ul></li></ul></li><li><span><a href=\"#Summary\" data-toc-modified-id=\"Summary-4\"><span class=\"toc-item-num\">4&nbsp;&nbsp;</span>Summary</a></span><ul class=\"toc-item\"><li><ul class=\"toc-item\"><li><span><a href=\"#Your-turn\" data-toc-modified-id=\"Your-turn-4.0.1\"><span class=\"toc-item-num\">4.0.1&nbsp;&nbsp;</span>Your turn</a></span></li><li><span><a href=\"#Boundary-value-problem-checklist\" data-toc-modified-id=\"Boundary-value-problem-checklist-4.0.2\"><span class=\"toc-item-num\">4.0.2&nbsp;&nbsp;</span>Boundary value problem checklist</a></span></li></ul></li></ul></li><li><span><a href=\"#Context\" data-toc-modified-id=\"Context-5\"><span class=\"toc-item-num\">5&nbsp;&nbsp;</span>Context</a></span></li><li><span><a href=\"#Link-to-the-TMF-problem\" data-toc-modified-id=\"Link-to-the-TMF-problem-6\"><span class=\"toc-item-num\">6&nbsp;&nbsp;</span>Link to the TMF problem</a></span></li><li><span><a href=\"#General-idea-between\" data-toc-modified-id=\"General-idea-between-7\"><span class=\"toc-item-num\">7&nbsp;&nbsp;</span>General idea between</a></span></li><li><span><a href=\"#Continuity-equation\" data-toc-modified-id=\"Continuity-equation-8\"><span class=\"toc-item-num\">8&nbsp;&nbsp;</span>Continuity equation</a></span><ul class=\"toc-item\"><li><span><a href=\"#The-continuity-equation\" data-toc-modified-id=\"The-continuity-equation-8.1\"><span class=\"toc-item-num\">8.1&nbsp;&nbsp;</span>The continuity equation</a></span></li><li><span><a href=\"#Physical-interpretation-of-the-divergence\" data-toc-modified-id=\"Physical-interpretation-of-the-divergence-8.2\"><span class=\"toc-item-num\">8.2&nbsp;&nbsp;</span>Physical interpretation of the divergence</a></span></li></ul></li></ul></div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0
   },
   "source": [
    "<div class=\"alert alert-warning\">\n",
    "\n",
    "## Putting it all together\n",
    "\n",
    "Recall our approach:\n",
    "1. Write a discrete approximation for mass conservation for gridblock C. This equation is the fundamental stencil.\n",
    "2. Apply this stencil to each gridblock in the grid to generate a unique equation for each gridblock in the grid.\n",
    "\n",
    "For n gridblocks, we can generate n equations.\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0
   },
   "source": [
    "\n",
    "We just developed the fundamental stencil for 1-D steady-state diffusion in terms of concentrations in gridblocks as:\n",
    "\n",
    "### 1-D steady - state diffusion stencil (aligned in the x direction)\n",
    "\n",
    "\\begin{align}\n",
    "&\\left(D\\theta {c_E - c_C \\over \\Delta x} +   D\\theta {c_W - c_C \\over \\Delta x}   \\right) (\\Delta y) (\\Delta z) = 0 \\label{eq651}\\\\\n",
    "\\end{align}\n",
    "\n",
    "It is convenient to rearrange the stencil and collect terms that multiply $c_E$, $c_C$ and $c_W$:\n",
    "\n",
    "\\begin{align}\n",
    "&\\left(D\\theta {\\Delta y \\Delta z \\over \\Delta x}\\right) c_E - \\left(2 D\\theta {\\Delta y \\Delta z \\over \\Delta x}\\right) c_C + \\left(D\\theta {\\Delta y \\Delta z \\over \\Delta x}\\right) c_W  = 0 \\label{eq652}\\\\\n",
    "\\end{align}\n",
    "\n",
    "If each gridblock is the same size, and porosity and the diffusion coefficient are everywhere the same (spatially homogeneous) then the stencil simplifies to:\n",
    "\n",
    "\\begin{align}\n",
    "& c_E -  2   c_C +  c_W  = 0 \\label{eq653}\\\\\n",
    "\\end{align}\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0
   },
   "source": [
    "## 5 - gridblock example\n",
    "\n",
    "Let's write the equations for the 5-gridblock example from before, now in terms of concentrations.\n",
    "\n",
    "<img src=\"figures/5node-const-c-bc.png\" style=\"height: 200px;\" >\n",
    "\n",
    "The total length of the domain is $2~m$ in the $x$ direction, each gridblock is the same size and porosity and diffusion coefficient are spatially homogeneous:\n",
    "* $\\Delta x=0.5 m$\n",
    "* $\\Delta y=0.3 m$\n",
    "* $\\Delta z=0.5 m$\n",
    "* $D=2\\times 10^{-10}~m^2/s$\n",
    "* $\\theta = 0.25$\n",
    "\n",
    "Note that the *nodes* of gridblock 1 and 5 are located on the boundary.\n",
    "\n",
    "#### Gridblock 1\n",
    "\n",
    "The node is on the boundary where the concentration is prescribed, so the equation is simply\n",
    "\n",
    "\\begin{align}\n",
    "c_1&= 2000 \\label{eq654}\\\\\n",
    "\\end{align}\n",
    "\n",
    "#### Gridblock 2\n",
    "\n",
    "<img src=\"figures/block2_eq.png\" style=\"height: 110px;\" >\n",
    "\n",
    "Because each gridblock is the same size and $D$ and $\\theta$ are spatially homogeneous, we can use the stencil in its simplest form \\ref{eq653} and the equation for gridblock 2 becomes:\n",
    "\n",
    "\n",
    "\\begin{align}\n",
    "c_1 -2c_2 + c_3 &= 0 \\label{eq655}\\\\\n",
    "\\end{align}\n",
    "\n",
    "\n",
    "#### Gridblock 3\n",
    "\n",
    "<img src=\"figures/block3_eq.png\" style=\"height: 110px;\" >\n",
    "\n",
    "The equation for gridblock 3:\n",
    "\n",
    "\\begin{align}\n",
    "c_2 -2c_3 + c_4 &= 0 \\label{eq656}\\\\\n",
    "\\end{align}\n",
    "\n",
    "#### Gridblock 4\n",
    "\n",
    "<img src=\"figures/block4_eq.png\" style=\"height: 110px;\" >\n",
    "\n",
    "The equation for gridblock 4:\n",
    "\n",
    "\n",
    "\\begin{align}\n",
    "c_3 -2c_4 + c_5  &= 0 \\label{eq657}\\\\\n",
    "\\end{align}\n",
    "\n",
    "#### Gridblock 5\n",
    "\n",
    "The node is on the boundary where the concentration is prescribed, so the equation is simply\n",
    "\n",
    "\\begin{align}\n",
    "c_5&= 93 \\label{eq658}\\\\\n",
    "\\end{align}\n",
    "\n",
    "#### Collecting all equations\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "  | Gridblock  | Equation      |\n",
    "  |:----------:|:--------------:|\n",
    "  | 1  | $$c_1 = 2000$$|\n",
    "  | 2  | $$c_1 -2c_2 + c_3 = 0$$|\n",
    "  | 3  | $$c_2 -2c_3 + c_4 = 0$$|\n",
    "  | 4  | $$c_3 -2c_4 + c_5  = 0 $$|\n",
    "  | 5  | $$c_5 = 93$$|\n",
    "\n",
    "### Simplify\n",
    "\n",
    "We can use the equation for gridblock 1 to simplify the equation for gridblock 2 by substituting the known value of $c_1$ into equation 2:\n",
    "\n",
    "$2000 -2c_2 + c_3 = 0$ or, bringing the known value to the right hand side,\n",
    "\n",
    "\\begin{align}\n",
    "-2c_2 + c_3 &= -2000 \\label{eq659}\\\\\n",
    "\\end{align}\n",
    "\n",
    "Similarly for equation 4,\n",
    "\n",
    "\n",
    "\\begin{align}\n",
    "c_3 -2c_4&= -93 \\label{eq6510}\\\\\n",
    "\\end{align}\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0
   },
   "source": [
    "### Equations for unknown concentrations\n",
    "\n",
    "Finally collecting all the equations for the unknown concentrations  $c_2$, $c_3$, $c_4$ together:\n",
    "\n",
    "\n",
    "  | Gridblock  | Equation      |\n",
    "  |:----------:|:--------------:|\n",
    "  | 2  | $$-2c_2 + c_3 =-2000$$|\n",
    "  | 3  | $$c_2 + c_4 -2c_3= 0$$|\n",
    "  | 4  | $$c_3 -2c_4 = -93 $$|\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0
   },
   "source": [
    "## Solve the system of equations\n",
    "\n",
    "Solve the equations by hand and plot the concentration versus $x$.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "lines_to_next_cell": 0
   },
   "source": [
    "<div class=\"alert alert-info\">\n",
    "\n",
    "#### Your answer here: \n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-warning\">\n",
    "\n",
    "## Plot it!\n",
    "\n",
    "Complete the python code below - replace `c[1]` to `c[3]` with your answers below, and then write the python code to plot the results. See the TMF notebook for an example.\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "# set up the plot\n",
    "\n",
    "c=np.zeros(5,float)\n",
    "x=np.zeros(5, float)\n",
    "c[0] = 2000  # lower boundary condition\n",
    "c[1] = 2000  # replace with the correct value\n",
    "c[2] = 2000  # replace with the correct value\n",
    "c[3] = 93    # replace with the correct value\n",
    "c[4] = 93    # upper boundary condition\n",
    "x[0] = 0.0\n",
    "x[1] = 0.5\n",
    "x[2] = 1.0\n",
    "x[3] = 1.5\n",
    "x[4] = 2.0\n",
    "\n",
    "# use matplotlib to produce plot of concentration vs x (see TMF notebook for an example)"
   ]
  }
 ],
 "metadata": {
  "jupytext": {
   "cell_metadata_filter": "all",
   "formats": "",
   "notebook_metadata_filter": "all",
   "text_representation": {
    "extension": ".py",
    "format_name": "percent",
    "format_version": "1.2",
    "jupytext_version": "1.0.0-rc1"
   }
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.5"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": true,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": true
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
